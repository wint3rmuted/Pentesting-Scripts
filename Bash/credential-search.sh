#!/bin/sh

OUTFILE="/tmp/output.txt"

##### (Cosmetic) Colour output
RED="\033[01;31m"      # Issues/Errors
GREEN="\033[01;32m"    # Success
YELLOW="\033[01;33m"   # Warnings/Information
BLUE="\033[01;34m"     # Heading
BOLD="\033[01;01m"     # Highlight
RESET="\033[00m"       # Normal


if [ 1 -eq 0 ]; then
if [ -e $OUTPUT_FILE ]; then
    echo "${BOLD}${RED}[!] Output file ${OUTPUT_FILE} already exists. Exit."
    exit
fi
fi


echo "${BOLD}${YELLOW}[~] System Information${RESET}"
echo "${BOLD}- Current user:${RESET}"
id
echo
echo "\n${BOLD}- Kernel:${RESET}"
uname -a
echo
echo "\n${BOLD}- System name/version${RESET}"
cat /etc/issue 2> /dev/null
cat /etc/*release 2> /dev/null
cat /proc/version 2> /dev/null
echo
echo "\n${BOLD}- Environment variables${RESET}"
export
echo
echo "\n${BOLD}- Running processes with potential credentials in cmdline${RESET}"
ps aux | grep -iE --color '(pwd|pass|-p)'
echo

echo "\n${BOLD}${YELLOW}[~] Shell history (all)${RESET}"
find -L /home/ -type f  -iname '*history' -exec ls -alh {} \; 2> /dev/null | tee tmp1.txt
find -L /root/ -type f  -iname '*history' -exec ls -alh {} \; 2> /dev/null | tee tmp2.txt
# todo: utiliser couleurs
echo "\n${BOLD}${YELLOW}[~] Shell history (with permissive file permissions)${RESET}"
cat tmp1.txt | grep -v 'rw-------'
cat tmp2.txt | grep -v 'rw-------'
rm tmp1.txt tmp2.txt

echo "\n${BOLD}${YELLOW}[~] SSH user files (.ssh directories)${RESET}"
find / -iname '*[.]ssh' -exec echo -e "\n"{}":" \; -exec ls -alh {} \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] SSH private keys${RESET}"
find / -type f -size -100k -exec sh -c "grep -l 'BEGIN.*PRIVATE' '{}' && ls -l {}" \; 2> /dev/null
find / -type f -iname 'id_rsa*' -exec ls -l {} \; -o -iname 'id_dsa*' -exec ls -l {} \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] Oracle Database connection information${RESET}"
find / -type f -iname 'tnsname.ora' -exec ls -l {} \; 2> /dev/null
find / -type f -size -100k -exec sh -c "grep -iI --quiet 'jdbc:oracle:thin' '{}' && ls -l {} && grep -inI --color 'jdbc:oracle:thin' '{}' && echo --------------------- && echo" \;  2> /dev/null

echo "\n${BOLD}${YELLOW}[~] JMX credentials${RESET}"
find / -type f -iname 'jmxremote.password' -exec ls -l {} \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] Tomcat configuration${RESET}"
find / -type f -iname 'tomcat-users.xml' -exec ls -l {} \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] Weblogic configuration (+ secret key)${RESET}"
find / -type f -iname 'nm-WebLogicConfig.properties' -exec ls -l {} \; 2> /dev/null
find / -type f -iname 'config.xml' -exec ls -l {} \; 2> /dev/null # mieux filtrer ?
find / -type f -iname 'SerializedSystemIni.dat' -exec ls -l {} \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] VsFTPd config + credentials${RESET}"
ls -alh /etc/vsftpd/* # creds in cleartext in /etc/vsftpd/user_list if not only local users
cat /etc/vsftpd/user_list

echo "\n${BOLD}${YELLOW}[~] Search for passwords in .xml files${RESET}"
find / -type f -iname '*.xml' -exec sh -c "grep -iIE --quiet '<(password|pass|passwd|pwd)>' '{}' && ls -l {} && grep -inE --color '<(password|pass|passwd|pwd)>' '{}' && echo --------------------- && echo" \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] Search for passwords in .properties files${RESET}"
find / -type f -iname '*.properties' -exec sh -c "grep -iIE --quiet '<(password|pass|passwd|pwd)>' '{}' && ls -l {} && grep -inE --color '<(password|pass|passwd|pwd)>' '{}' && echo --------------------- && echo" \; 2> /dev/null

echo "\n${BOLD}${YELLOW}[~] Search for passwords globally${RESET}"
find / -type f -size -100k -exec sh -c "grep -iIE --quiet '(password|pass|passwd|pwd) *(=|:)' '{}' && ls -l {} && grep -inE --color '(password|pass|passwd) *(=|:)' '{}' && echo --------------------- && echo" \;  2> /dev/null

echo "\n${BOLD}${YELLOW}[~] Search for hashes globally${RESET}"
find / -type f -size -100k -exec sh -c "grep -iIE --quiet '[0-9a-fA-F]{32}' '{}' && ls -l {} && grep -iInE '[0-9a-fA-F]{32}' '{}' && echo && echo" \;  2> /dev/null
